<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOBAå¯¹æˆ˜æ¸¸æˆ</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="game-container">
        <header class="game-header">
            <h1>MOBAå¯¹æˆ˜æ¸¸æˆ</h1>
            <div class="connection-status">
                <span id="status-indicator" class="status-offline">ç¦»çº¿</span>
                <span id="player-count">åœ¨çº¿ç©å®¶: 0</span>
            </div>
        </header>
        
        <main class="game-main">
            <div class="game-area">
                <canvas id="game-canvas" width="800" height="600"></canvas>
            </div>
            
            <aside class="game-info">
                <div class="player-info">
                    <h3>ç©å®¶ä¿¡æ¯</h3>
                    <div class="info-item">
                        <span>ç©å®¶ID:</span>
                        <span id="player-id">æœªè¿æ¥</span>
                    </div>
                    <div class="info-item">
                        <span>ä½ç½®:</span>
                        <span id="player-position">X: 0, Y: 0</span>
                    </div>
                    <div class="info-item">
                        <span>çŠ¶æ€:</span>
                        <span id="player-status">ç­‰å¾…ä¸­</span>
                    </div>
                    <div class="info-item">
                        <span>è¡€é‡:</span>
                        <div class="status-bar">
                            <div id="health-bar" class="bar health-bar"></div>
                            <span id="health-value">1000/1000</span>
                        </div>
                    </div>
                    <div class="info-item">
                        <span>æŠµæŠ—å€¼:</span>
                        <div class="status-bar">
                            <div id="resistance-bar" class="bar resistance-bar"></div>
                            <span id="resistance-value">50/50</span>
                        </div>
                    </div>
                    <div class="info-item">
                        <span>è“é‡:</span>
                        <div class="status-bar">
                            <div id="mana-bar" class="bar mana-bar"></div>
                            <span id="mana-value">1000/1000</span>
                        </div>
                    </div>
                </div>
                
                <div class="controls-info">
                    <h3>æ§åˆ¶è¯´æ˜</h3>
                    <div class="control-item">
                        <span class="key">W</span>
                        <span>å‘ä¸Šç§»åŠ¨</span>
                    </div>
                    <div class="control-item">
                        <span class="key">A</span>
                        <span>å‘å·¦ç§»åŠ¨</span>
                    </div>
                    <div class="control-item">
                        <span class="key">S</span>
                        <span>å‘ä¸‹ç§»åŠ¨</span>
                    </div>
                    <div class="control-item">
                        <span class="key">D</span>
                        <span>å‘å³ç§»åŠ¨</span>
                    </div>
                    <div class="control-item">
                        <span class="key">J</span>
                        <span>æ³¢æ‰“æ³• (æ¶ˆè€—100è“é‡)</span>
                    </div>
                </div>
                
                <div class="game-controls">
                    <div class="server-info">
                        <p>ä½¿ç”¨Photon Cloudè¿›è¡Œå¤šäººè”æœº</p>
                        <small>GitHub Pagesç¯å¢ƒï¼šè‡ªåŠ¨ä½¿ç”¨Photon Cloudè¿œç¨‹è”æœº</small>
                    </div>
                    <div class="button-container">
                        <button id="connect-btn">è¿æ¥æœåŠ¡å™¨</button>
                        <button id="match-btn" disabled>å¼€å§‹åŒ¹é…</button>
                        <button id="disconnect-btn" disabled>æ–­å¼€è¿æ¥</button>
                    </div>
                </div>
            </aside>
        </main>
        
        <footer class="game-footer">
            <p>ä½¿ç”¨WASDé”®æ§åˆ¶è§’è‰²ç§»åŠ¨</p>
        </footer>
        
        <!-- ç§»åŠ¨ç«¯æ§åˆ¶ç•Œé¢ -->
        <div id="mobile-controls" class="mobile-controls hidden">
            <div class="joystick-container">
                <div id="joystick" class="joystick">
                    <div id="joystick-handle" class="joystick-handle"></div>
                </div>
            </div>
            <div class="action-buttons">
                <button id="mobile-wave-btn" class="action-btn wave-btn">æ³¢æ‰“æ³•</button>
            </div>
        </div>
    </div>
    
    <div id="notification" class="notification hidden"></div>
    
    <!-- Photon Cloud SDK - è¿œç¨‹è”æœºä¸“ç”¨ -->
    <script>
        // å¢å¼ºSDKåŠ è½½æ£€æŸ¥ - æ”¯æŒè¿œç¨‹è”æœº
        window.addEventListener('load', function() {
            console.log('ğŸŒ å¼€å§‹åŠ è½½Photon Cloud SDK...');
            
            // æ£€æµ‹å½“å‰ç¯å¢ƒ
            const isGitHubPages = window.location.hostname.includes('github.io');
            
            // ä¼˜å…ˆä½¿ç”¨æœ¬åœ°SDKæ–‡ä»¶ï¼ŒCDNä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ
            const sdkSources = [
                './photon-sdk/lib/photon.min.js', // æœ¬åœ°SDKæ–‡ä»¶
                'https://unpkg.com/@photonengine/realtime@5.0.4/dist/realtime.min.js',
                'https://cdn.jsdelivr.net/npm/@photonengine/realtime@5.0.4/dist/realtime.min.js'
            ];
            
            let currentSource = 0;
            let sdkLoaded = false;
            
            function checkSDKLoad() {
                // æ£€æŸ¥Photon SDKæ˜¯å¦å·²åŠ è½½ - å¢å¼ºæ£€æµ‹é€»è¾‘
                const sdkAvailable = typeof loadBalancingClient !== 'undefined' || 
                    (typeof window.Photon !== 'undefined' && window.Photon.LoadBalancing) ||
                    typeof window.ExitGames !== 'undefined' ||
                    (typeof window !== 'undefined' && window.Photon && window.Photon.LoadBalancing);
                
                if (sdkAvailable) {
                    console.log('âœ… Photon SDKåŠ è½½æˆåŠŸï¼Œå‡†å¤‡è¿œç¨‹è”æœº');
                    sdkLoaded = true;
                    
                    // æ›´æ–°é¡µé¢çŠ¶æ€
                    const statusIndicator = document.getElementById('status-indicator');
                    if (statusIndicator) {
                        statusIndicator.textContent = 'SDKå°±ç»ª';
                        statusIndicator.className = 'status-ready';
                    }
                    
                    // GitHub Pagesç¯å¢ƒï¼šè‡ªåŠ¨å°è¯•è¿æ¥å¹¶è§¦å‘äº‹ä»¶
                    if (isGitHubPages) {
                        console.log('ğŸŒ GitHub Pagesç¯å¢ƒï¼šè‡ªåŠ¨å°è¯•Photon Cloudè¿æ¥');
                        
                        // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶é€šçŸ¥SDKå·²åŠ è½½
                        const sdkLoadedEvent = new CustomEvent('photonSDKLoaded');
                        window.dispatchEvent(sdkLoadedEvent);
                        
                        setTimeout(() => {
                            if (window.networkManager && !window.networkManager.isConnected) {
                                console.log('ğŸŒ å¼€å§‹è‡ªåŠ¨è¿æ¥Photon Cloud...');
                                window.networkManager.connect();
                            }
                        }, 2000);
                    }
                    return;
                }
                
                if (!sdkLoaded && currentSource < sdkSources.length) {
                    console.log(`ğŸ”„ å°è¯•SDKæº ${currentSource + 1}: ${sdkSources[currentSource]}`);
                    
                    const script = document.createElement('script');
                    script.src = sdkSources[currentSource];
                    
                    script.onload = function() {
                        console.log(`âœ… SDKæº ${currentSource + 1} åŠ è½½å®Œæˆ`);
                        setTimeout(checkSDKLoad, 1000);
                    };
                    
                    script.onerror = function() {
                        console.log(`âŒ SDKæº ${currentSource + 1} åŠ è½½å¤±è´¥`);
                        currentSource++;
                        if (currentSource < sdkSources.length) {
                            setTimeout(function() {
                                document.head.appendChild(script);
                            }, 500);
                        } else {
                            console.error('âŒ æ‰€æœ‰SDKæºéƒ½åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                            
                            // GitHub Pagesç¯å¢ƒï¼šæ˜¾ç¤ºå‹å¥½æç¤º
                            if (isGitHubPages) {
                                const statusIndicator = document.getElementById('status-indicator');
                                if (statusIndicator) {
                                    statusIndicator.textContent = 'SDKåŠ è½½å¤±è´¥';
                                    statusIndicator.className = 'status-offline';
                                }
                                showNotification('Photon SDKåŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
                            }
                        }
                    };
                    
                    document.head.appendChild(script);
                } else if (!sdkLoaded) {
                    console.error('âŒ æ— æ³•åŠ è½½Photon SDKï¼Œè¿œç¨‹è”æœºåŠŸèƒ½å°†ä¸å¯ç”¨');
                }
            }
            
            // å»¶è¿Ÿæ£€æŸ¥ï¼Œç¡®ä¿ä¸»CDNæœ‰æœºä¼šåŠ è½½
            setTimeout(checkSDKLoad, 2000);
        });
    </script>
    
    <script src="game.js"></script>
    <script src="network.js"></script>
    <script src="mobile-controls.js"></script>
    <script src="main.js"></script>
</body>
</html>