<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photon Cloudç›´æ¥è¿æ¥æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; font-weight: bold; }
        .online { background-color: #d4edda; color: #155724; }
        .offline { background-color: #f8d7da; color: #721c24; }
        .connecting { background-color: #fff3cd; color: #856404; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .connect { background-color: #007bff; color: white; }
        .disconnect { background-color: #dc3545; color: white; }
    </style>
</head>
<body>
    <h1>Photon Cloudç›´æ¥è¿æ¥æµ‹è¯•</h1>
    <div id="status" class="status offline">ç¦»çº¿</div>
    <button class="connect" onclick="testDirectConnection()">æµ‹è¯•ç›´æ¥è¿æ¥</button>
    <div id="log" style="margin-top: 20px; height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;"></div>

    <script>
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}<br>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateStatus(status) {
            const statusElement = document.getElementById('status');
            statusElement.className = 'status ' + status;
            statusElement.textContent = status === 'online' ? 'åœ¨çº¿' : status === 'connecting' ? 'è¿æ¥ä¸­' : 'ç¦»çº¿';
        }

        // æµ‹è¯•ç›´æ¥WebSocketè¿æ¥åˆ°PhotonæœåŠ¡å™¨
        async function testDirectConnection() {
            updateStatus('connecting');
            log('å¼€å§‹æµ‹è¯•ç›´æ¥è¿æ¥åˆ°PhotonæœåŠ¡å™¨...');
            
            try {
                // æµ‹è¯•ç½‘ç»œè¿æ¥
                log('1. æµ‹è¯•ç½‘ç»œè¿æ¥...');
                const networkTest = await testNetworkConnectivity();
                if (!networkTest) {
                    log('âŒ ç½‘ç»œè¿æ¥æµ‹è¯•å¤±è´¥');
                    updateStatus('offline');
                    return;
                }
                log('âœ“ ç½‘ç»œè¿æ¥æ­£å¸¸');

                // æµ‹è¯•PhotonæœåŠ¡å™¨è¿æ¥
                log('2. æµ‹è¯•PhotonæœåŠ¡å™¨è¿æ¥...');
                const photonTest = await testPhotonServer();
                if (!photonTest) {
                    log('âŒ PhotonæœåŠ¡å™¨è¿æ¥æµ‹è¯•å¤±è´¥');
                    updateStatus('offline');
                    return;
                }
                log('âœ“ PhotonæœåŠ¡å™¨è¿æ¥æ­£å¸¸');

                // æµ‹è¯•WebSocketè¿æ¥
                log('3. æµ‹è¯•WebSocketè¿æ¥...');
                const wsTest = await testWebSocketConnection();
                if (!wsTest) {
                    log('âŒ WebSocketè¿æ¥æµ‹è¯•å¤±è´¥');
                    updateStatus('offline');
                    return;
                }
                log('âœ“ WebSocketè¿æ¥æ­£å¸¸');

                updateStatus('online');
                log('ğŸ‰ æ‰€æœ‰è¿æ¥æµ‹è¯•é€šè¿‡ï¼');
                log('é—®é¢˜å¯èƒ½åœ¨äºPhoton SDKçš„CDNé“¾æ¥è¢«å±è”½');
                log('å»ºè®®è§£å†³æ–¹æ¡ˆï¼š');
                log('1. ä½¿ç”¨æœ¬åœ°WebSocketæœåŠ¡å™¨ï¼ˆå½“å‰å·²è¿è¡Œï¼‰');
                log('2. ä¸‹è½½Photon SDKåˆ°æœ¬åœ°æ–‡ä»¶');
                log('3. ä½¿ç”¨å…¶ä»–CDNæœåŠ¡');

            } catch (error) {
                log('âŒ æµ‹è¯•å¤±è´¥: ' + error);
                updateStatus('offline');
            }
        }

        // æµ‹è¯•ç½‘ç»œè¿æ¥
        async function testNetworkConnectivity() {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = 'https://www.google.com/favicon.ico?t=' + Date.now();
                setTimeout(() => resolve(false), 5000);
            });
        }

        // æµ‹è¯•PhotonæœåŠ¡å™¨è¿æ¥
        async function testPhotonServer() {
            return new Promise((resolve) => {
                const xhr = new XMLHttpRequest();
                xhr.timeout = 5000;
                xhr.onload = () => resolve(xhr.status === 200);
                xhr.onerror = () => resolve(false);
                xhr.ontimeout = () => resolve(false);
                
                try {
                    xhr.open('GET', 'https://dashboard.photonengine.com/', true);
                    xhr.send();
                } catch {
                    resolve(false);
                }
            });
        }

        // æµ‹è¯•WebSocketè¿æ¥
        async function testWebSocketConnection() {
            return new Promise((resolve) => {
                // æµ‹è¯•æœ¬åœ°WebSocketæœåŠ¡å™¨
                const ws = new WebSocket('ws://localhost:8080');
                
                ws.onopen = () => {
                    log('âœ“ æœ¬åœ°WebSocketæœåŠ¡å™¨è¿æ¥æˆåŠŸ');
                    ws.close();
                    resolve(true);
                };
                
                ws.onerror = () => {
                    log('âŒ æœ¬åœ°WebSocketæœåŠ¡å™¨è¿æ¥å¤±è´¥');
                    resolve(false);
                };
                
                setTimeout(() => {
                    if (ws.readyState !== WebSocket.OPEN) {
                        log('âŒ æœ¬åœ°WebSocketè¿æ¥è¶…æ—¶');
                        resolve(false);
                    }
                }, 3000);
            });
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
        window.onload = function() {
            log('é¡µé¢åŠ è½½å®Œæˆ');
            log('ç‚¹å‡»"æµ‹è¯•ç›´æ¥è¿æ¥"æŒ‰é’®æ£€æŸ¥ç½‘ç»œçŠ¶æ€');
            log('å½“å‰é—®é¢˜ï¼šPhoton SDK CDNé“¾æ¥æ— æ³•è®¿é—®');
        };
    </script>
</body>
</html>