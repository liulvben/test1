<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Pages + Photon Cloud ä¿®å¤ç‰ˆ</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            min-height: 100vh;
        }
        .header { 
            text-align: center; 
            margin-bottom: 30px; 
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 20px;
        }
        .header h1 { 
            color: #4a9eff; 
            font-size: 2.5em; 
            margin-bottom: 10px;
        }
        .status-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin-bottom: 30px;
        }
        .status-item { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 8px; 
            text-align: center;
            border-left: 4px solid #4a9eff;
        }
        .status-item h3 { 
            margin: 0 0 10px 0; 
            color: #495057;
            font-size: 1em;
        }
        .status-value { 
            font-size: 1.5em; 
            font-weight: bold; 
            color: #4a9eff;
        }
        .controls { 
            display: flex; 
            gap: 10px; 
            justify-content: center; 
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .btn { 
            padding: 10px 20px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-weight: bold; 
            transition: all 0.3s;
        }
        .btn-primary { 
            background: #007bff; 
            color: white;
        }
        .btn-success { 
            background: #28a745; 
            color: white;
        }
        .btn-danger { 
            background: #dc3545; 
            color: white;
        }
        .btn:disabled { 
            background: #6c757d; 
            cursor: not-allowed;
        }
        .log-container { 
            background: #1a1a1a; 
            color: #00ff00; 
            padding: 15px; 
            border-radius: 5px; 
            font-family: 'Courier New', monospace; 
            height: 300px; 
            overflow-y: auto;
            margin-top: 20px;
            font-size: 0.9em;
        }
        .diagnostic { 
            background: #fff3cd; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }
        .solution { 
            background: #d4edda; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 20px 0;
            border-left: 4px solid #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ GitHub Pages Photon Cloud ä¿®å¤ç‰ˆ</h1>
            <p>ä¸“é—¨è§£å†³GitHub Pagesç¯å¢ƒä¸‹çš„ç½‘ç»œè¿æ¥é—®é¢˜</p>
        </div>
        
        <div class="diagnostic">
            <h3>ğŸ” é—®é¢˜è¯Šæ–­</h3>
            <p><strong>é—®é¢˜ï¼š</strong>GitHub Pagesç¯å¢ƒä¸‹Photon Cloudè¿æ¥å¤±è´¥</p>
            <p><strong>å¯èƒ½åŸå› ï¼š</strong></p>
            <ul>
                <li>GitHub Pagesçš„CORSé™åˆ¶</li>
                <li>WebSocketè¿æ¥è¢«é˜»æ­¢</li>
                <li>CDNé“¾æ¥è¢«å±è”½</li>
                <li>HTTPS/HTTPæ··åˆå†…å®¹é—®é¢˜</li>
            </ul>
        </div>
        
        <div class="status-grid">
            <div class="status-item">
                <h3>è¿æ¥çŠ¶æ€</h3>
                <div id="connection-status" class="status-value">ğŸ”´ ç¦»çº¿</div>
            </div>
            <div class="status-item">
                <h3>SDKçŠ¶æ€</h3>
                <div id="sdk-status" class="status-value">ğŸ”„ æ£€æµ‹ä¸­</div>
            </div>
            <div class="status-item">
                <h3>ç½‘ç»œæ£€æµ‹</h3>
                <div id="network-status" class="status-value">â³ æµ‹è¯•ä¸­</div>
            </div>
            <div class="status-item">
                <h3>ç¯å¢ƒæ£€æµ‹</h3>
                <div id="env-status" class="status-value">ğŸŒ GitHub Pages</div>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn btn-primary" onclick="testNetwork()">ğŸŒ æµ‹è¯•ç½‘ç»œè¿æ¥</button>
            <button class="btn btn-success" onclick="connectPhoton()">ğŸš€ è¿æ¥Photon</button>
            <button class="btn btn-danger" onclick="disconnectPhoton()" disabled>âŒ æ–­å¼€</button>
        </div>
        
        <div class="solution">
            <h3>ğŸ’¡ è§£å†³æ–¹æ¡ˆ</h3>
            <p>æœ¬é¡µé¢é‡‡ç”¨ä»¥ä¸‹æŠ€æœ¯è§£å†³GitHub Pagesè¿æ¥é—®é¢˜ï¼š</p>
            <ul>
                <li>ä½¿ç”¨HTTPSå®‰å…¨çš„WebSocketè¿æ¥</li>
                <li>åŠ¨æ€CDNåŠ è½½ç­–ç•¥</li>
                <li>ç½‘ç»œè¿æ¥é¢„æ£€æµ‹</li>
                <li>è¯¦ç»†çš„é”™è¯¯è¯Šæ–­ä¿¡æ¯</li>
            </ul>
        </div>
        
        <div class="log-container" id="log">
            <div>[ç³»ç»Ÿ] ğŸ”§ GitHub Pages Photon Cloudä¿®å¤ç‰ˆå·²åŠ è½½</div>
            <div>[ç³»ç»Ÿ] ğŸŒ å¼€å§‹ç¯å¢ƒæ£€æµ‹...</div>
        </div>
    </div>

    <script>
        // ç¯å¢ƒæ£€æµ‹
        function detectEnvironment() {
            const isGitHubPages = window.location.hostname.includes('github.io');
            const isHTTPS = window.location.protocol === 'https:';
            
            document.getElementById('env-status').textContent = 
                isGitHubPages ? 'ğŸŒ GitHub Pages' : 'ğŸ’» æœ¬åœ°ç¯å¢ƒ';
            
            log(`ç¯å¢ƒæ£€æµ‹: ${isGitHubPages ? 'GitHub Pages' : 'æœ¬åœ°'}, HTTPS: ${isHTTPS}`);
            
            if (!isHTTPS) {
                log('âš ï¸ è­¦å‘Š: éHTTPSç¯å¢ƒå¯èƒ½å½±å“WebSocketè¿æ¥');
            }
        }

        // ç½‘ç»œè¿æ¥æµ‹è¯•
        async function testNetwork() {
            const networkStatus = document.getElementById('network-status');
            networkStatus.textContent = 'ğŸ”„ æµ‹è¯•ä¸­...';
            networkStatus.style.color = '#ffc107';
            
            log('ğŸŒ å¼€å§‹ç½‘ç»œè¿æ¥æµ‹è¯•...');
            
            const testUrls = [
                'https://cdn.jsdelivr.net',
                'https://unpkg.com',
                'https://photonengine.com'
            ];
            
            let successCount = 0;
            
            for (let i = 0; i < testUrls.length; i++) {
                try {
                    const response = await fetch(testUrls[i], { 
                        method: 'HEAD',
                        mode: 'no-cors'
                    });
                    successCount++;
                    log(`âœ… ${testUrls[i]} - å¯è®¿é—®`);
                } catch (error) {
                    log(`âŒ ${testUrls[i]} - è®¿é—®å¤±è´¥`);
                }
            }
            
            if (successCount > 0) {
                networkStatus.textContent = 'âœ… ç½‘ç»œæ­£å¸¸';
                networkStatus.style.color = '#28a745';
                log(`ğŸŒ ç½‘ç»œæµ‹è¯•å®Œæˆ: ${successCount}/${testUrls.length} ä¸ªæœåŠ¡å¯è®¿é—®`);
            } else {
                networkStatus.textContent = 'âŒ ç½‘ç»œå¼‚å¸¸';
                networkStatus.style.color = '#dc3545';
                log('âŒ ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®');
            }
        }

        // Photon SDKåŠ è½½
        function loadPhotonSDK() {
            return new Promise((resolve, reject) => {
                if (window.loadBalancingClient) {
                    log('âœ… Photon SDKå·²åŠ è½½');
                    resolve();
                    return;
                }
                
                log('ğŸ“¥ å¼€å§‹åŠ è½½Photon SDK...');
                
                const cdns = [
                    'https://cdn.jsdelivr.net/npm/@photonengine/realtime@5.0.4/dist/realtime.min.js',
                    'https://unpkg.com/@photonengine/realtime@5.0.4/dist/realtime.min.js'
                ];
                
                let currentCdn = 0;
                
                function tryLoad() {
                    if (currentCdn >= cdns.length) {
                        reject('æ‰€æœ‰CDNåŠ è½½å¤±è´¥');
                        return;
                    }
                    
                    const script = document.createElement('script');
                    script.src = cdns[currentCdn];
                    
                    script.onload = () => {
                        log(`âœ… CDNåŠ è½½æˆåŠŸ: ${cdns[currentCdn]}`);
                        setTimeout(() => {
                            if (window.loadBalancingClient) {
                                resolve();
                            } else {
                                currentCdn++;
                                tryLoad();
                            }
                        }, 1000);
                    };
                    
                    script.onerror = () => {
                        log(`âŒ CDNåŠ è½½å¤±è´¥: ${cdns[currentCdn]}`);
                        currentCdn++;
                        tryLoad();
                    };
                    
                    document.head.appendChild(script);
                }
                
                tryLoad();
            });
        }

        // Photonè¿æ¥
        async function connectPhoton() {
            const statusElement = document.getElementById('connection-status');
            const sdkStatusElement = document.getElementById('sdk-status');
            
            try {
                statusElement.textContent = 'ğŸ”„ è¿æ¥ä¸­...';
                statusElement.style.color = '#ffc107';
                
                log('ğŸš€ å¼€å§‹è¿æ¥Photon Cloud...');
                
                // åŠ è½½SDK
                await loadPhotonSDK();
                sdkStatusElement.textContent = 'âœ… å·²åŠ è½½';
                sdkStatusElement.style.color = '#28a745';
                
                // åˆ›å»ºå®¢æˆ·ç«¯
                const client = new loadBalancingClient({
                    appId: '84e83fae-288e-4cf8-87e8-da69c2639380',
                    appVersion: '1.0',
                    useWSS: true // ä½¿ç”¨å®‰å…¨çš„WebSocket
                });
                
                // è®¾ç½®äº‹ä»¶ç›‘å¬
                client.on('connectionStateChange', (state) => {
                    log(`ğŸ”Œ è¿æ¥çŠ¶æ€: ${state}`);
                    
                    if (state === 'Joined') {
                        statusElement.textContent = 'âœ… å·²è¿æ¥';
                        statusElement.style.color = '#28a745';
                        log('ğŸ‰ æˆåŠŸè¿æ¥åˆ°Photon Cloud!');
                        
                        // å¯ç”¨æ–­å¼€æŒ‰é’®
                        document.querySelector('.btn-danger').disabled = false;
                    } else if (state === 'Disconnected') {
                        statusElement.textContent = 'ğŸ”´ ç¦»çº¿';
                        statusElement.style.color = '#dc3545';
                        document.querySelector('.btn-danger').disabled = true;
                    }
                });
                
                client.on('error', (error) => {
                    log(`âŒ è¿æ¥é”™è¯¯: ${error}`);
                    statusElement.textContent = 'âŒ è¿æ¥å¤±è´¥';
                    statusElement.style.color = '#dc3545';
                });
                
                // è¿æ¥
                client.connectAndJoinRandomRoom({ maxPlayers: 4 });
                
            } catch (error) {
                log(`âŒ è¿æ¥å¤±è´¥: ${error}`);
                statusElement.textContent = 'âŒ è¿æ¥å¤±è´¥';
                statusElement.style.color = '#dc3545';
                sdkStatusElement.textContent = 'âŒ åŠ è½½å¤±è´¥';
                sdkStatusElement.style.color = '#dc3545';
            }
        }

        function disconnectPhoton() {
            log('ğŸ”Œ æ–­å¼€Photonè¿æ¥');
            const statusElement = document.getElementById('connection-status');
            statusElement.textContent = 'ğŸ”´ ç¦»çº¿';
            statusElement.style.color = '#dc3545';
            document.querySelector('.btn-danger').disabled = true;
        }

        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.textContent = `[${timestamp}] ${message}`;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        // é¡µé¢åŠ è½½
        window.addEventListener('load', () => {
            detectEnvironment();
            testNetwork();
            
            // è‡ªåŠ¨æ£€æµ‹SDK
            setTimeout(() => {
                if (window.loadBalancingClient) {
                    document.getElementById('sdk-status').textContent = 'âœ… å·²åŠ è½½';
                    document.getElementById('sdk-status').style.color = '#28a745';
                } else {
                    document.getElementById('sdk-status').textContent = 'âŒ æœªåŠ è½½';
                    document.getElementById('sdk-status').style.color = '#dc3545';
                }
            }, 3000);
        });
    </script>
</body>
</html>