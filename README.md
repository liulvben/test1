# MOBA对战游戏

一个基于HTML5 Canvas和WebSocket的联网对战MOBA小游戏，支持远程联机和跨平台对战。

## 功能特点

- **双模式网络支持**: 支持WebSocket本地服务器和Photon Cloud远程联机两种模式
- **实时联网对战**: 使用WebSocket技术实现玩家之间的实时对战
- **Photon Cloud远程联机**: 无需配置服务器，直接使用Photon云服务进行全球联机
- **远程联机支持**: 支持局域网和互联网远程联机对战
- **跨平台支持**: 支持PC端和移动端（安卓手机）联机对战
- **移动端控制**: 移动设备上提供虚拟摇杆和触屏控制
- **流畅的角色控制**: PC端使用WASD键，移动端使用虚拟摇杆
- **波打法技能**: 使用J键（PC端）或按钮（移动端）释放波打法，消耗100蓝量
- **移动限制机制**: 使用波打法后0.5秒内无法移动，增加策略性
- **视觉效果**: 蓝色圆形角色设计，带有移动轨迹效果
- **匹配系统**: 自动匹配玩家进行对战
- **游戏状态同步**: 实时同步所有玩家的位置和状态
- **GitHub Pages部署**: 支持通过GitHub Pages进行静态部署

## 技术栈

- **前端**: HTML5, CSS3, JavaScript (ES6+)
- **图形渲染**: HTML5 Canvas
- **网络通信**: WebSocket, Photon Cloud
- **后端**: Node.js, ws库
- **移动端支持**: 响应式设计，触摸事件处理
- **云服务**: Photon Cloud (实时游戏服务)
- **部署**: GitHub Pages, 静态文件托管

## 安装和运行

### 本地服务器模式（推荐）

1. **安装依赖**
   ```bash
   npm install
   ```

2. **启动服务器**
   ```bash
   npm start
   # 或直接运行
   node server.js
   ```

3. **打开游戏**
   在浏览器中访问 `http://localhost:8080`

### Photon Cloud远程联机模式

1. **直接访问**
   在浏览器中打开 `index.html` 文件

2. **选择连接方式**
   点击"连接"按钮，选择"Photon Cloud"模式

3. **开始游戏**
   系统将自动连接到Photon云服务，无需配置服务器

### GitHub Pages部署模式

1. 将项目推送到GitHub仓库
2. 在仓库设置中启用GitHub Pages
3. 访问 `https://你的用户名.github.io/仓库名`

### 移动端访问

- 使用手机浏览器访问上述任一地址
- 系统将自动显示移动端控制界面

## 游戏操作

### PC端操作
- **W**: 向上移动
- **A**: 向左移动
- **S**: 向下移动
- **D**: 向右移动
- **J**: 波打法 (消耗100蓝量)

### 移动端操作
- **虚拟摇杆**: 控制角色移动方向
- **波打法按钮**: 释放波打法技能 (消耗100蓝量)

## 游戏流程

1. 在服务器地址输入框中输入服务器地址（本地使用默认地址即可）
2. 点击"连接服务器"按钮连接到游戏服务器
3. 点击"开始匹配"按钮寻找对手
4. 匹配成功后，使用相应控制方式控制角色移动
5. 使用波打法技能攻击对手
6. 游戏结束后可以重新开始匹配

## 远程联机设置

### 局域网联机

1. 确保服务器和所有客户端设备在同一局域网内
2. 启动服务器后，查看控制台显示的局域网IP地址
3. 其他设备通过该IP地址访问游戏
4. 在服务器地址输入框中输入 `ws://[服务器IP]:8080/ws`

### 互联网联机

1. 确保服务器有公网IP或使用内网穿透工具
2. 配置端口转发，将8080端口映射到服务器
3. 客户端在服务器地址输入框中输入公网地址
4. 注意：可能需要配置防火墙规则允许8080端口的入站连接

## 项目结构

```
moba-game/
├── index.html              # 主HTML文件（支持Photon Cloud远程联机）
├── index-github.html       # GitHub Pages部署入口页面
├── styles.css              # 样式文件（包含移动端控制样式）
├── game.js                 # 游戏核心逻辑
├── network.js              # 网络通信模块（支持WebSocket和Photon Cloud）
├── mobile-controls.js     # 移动端控制模块
├── main.js                 # 主应用程序入口
├── server.js               # Node.js服务器
├── start-server.bat        # Windows服务器启动脚本
├── package.json            # 项目配置
├── _config.yml             # GitHub Pages配置文件
├── .nojekyll               # GitHub Pages配置
├── PHOTON_DEPLOYMENT_GUIDE.md  # Photon Cloud部署指南
├── SERVER_DEPLOYMENT_GUIDE.md  # 服务器部署指南
├── photon-sdk/             # Photon SDK本地文件
│   ├── lib/                # SDK库文件
│   ├── doc/                # 文档
│   └── src/                # 源代码
└── README.md               # 项目说明
```

## 自定义配置

### 修改服务器地址

在游戏界面的服务器地址输入框中直接修改，或在 `network.js` 文件中修改默认值：

```javascript
this.serverUrl = 'ws://your-server-address:port/ws';
```

### 修改游戏参数

在 `game.js` 文件中可以修改以下参数：

- `speed`: 角色移动速度
- `radius`: 角色大小
- `maxTrailLength`: 移动轨迹长度
- `waveCooldownDuration`: 波打法冷却时间（毫秒）
- `maxResistance`: 最大抵抗值
- `resistanceRecoveryRate`: 抵抗值恢复速度

## 开发说明

### 添加新功能

1. 在 `game.js` 中添加游戏逻辑
2. 在 `network.js` 中添加网络通信协议
3. 在 `server.js` 中添加服务器端处理逻辑
4. 在 `mobile-controls.js` 中添加移动端控制逻辑
5. 在 `styles.css` 中添加样式

### 自定义角色外观

在 `Player` 类的 `render` 方法中修改角色绘制代码。

## 故障排除

### 无法连接到服务器

1. 确保服务器已启动
2. 检查防火墙设置，允许8080端口的入站连接
3. 确认服务器地址和端口正确
4. 确保服务器监听所有网络接口（0.0.0.0）而非仅localhost

### 移动端控制不响应

1. 确保使用的是移动设备浏览器
2. 检查浏览器是否支持触摸事件
3. 尝试刷新页面重新初始化移动端控制

### 游戏卡顿

1. 检查网络连接
2. 关闭其他占用资源的程序
3. 尝试使用更现代的浏览器

### 手机无法连接电脑服务器

1. **检查地址格式**：确保在手机浏览器中输入完整的URL，包括 `http://` 前缀
   - 正确：`http://10.18.43.176:8080`
   - 错误：`10.18.43.176:8080`

2. **检查网络连接**：
   - 确保手机和电脑在同一局域网内
   - 检查电脑的防火墙设置，允许8080端口的入站连接

3. **检查服务器状态**：
   - 确保服务器正在运行，没有错误信息
   - 检查服务器控制台显示的IP地址是否正确

4. **尝试其他浏览器**：
   - 有些移动浏览器可能不支持WebSocket
   - 推荐使用Chrome、Firefox或Safari等现代浏览器

## 许可证

MIT License